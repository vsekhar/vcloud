#!/bin/bash

. CREDENTIALS
. sshnh
. getreservation

# command line parameters
debug=0
verbose=0
while getopts dvr:f: opt_name
do
	case $opt_name in
	d)		debug=1;;
	v)		verbose=1;;
	r)		reservation_file=$OPTARG;;
	\?)		printf "Usage: %s: [-d] [-v] [instance_number] \n"  $0
			exit 2;;
	:)		echo "Option -$OPTARG requires an argument" >&2
			exit 1;;
	esac
done

shift $(($OPTIND - 1))
instance_number=$1
[ ! $instance_number -ge 0 ] && instance_number=0

getreservation $reservation_file
[ $verbose -ne 0 ] && echo reservation: $reservation_id

instances=`ec2-describe-instances --filter reservation-id=$reservation_id | grep ^INSTANCE`
[ $verbose -ne 0 ] && echo instances: $instances
hostnames=`echo "${instances}" | cut -f4`
[ $verbose -ne 0 ] && echo hostnames: $hostnames
sshnh ${login_user}@${hostnames[$instance_number]}

